"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function e(t){return typeof t}:function e(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function e(t,n,r){var o=_superPropBase(t,n);if(o){var i=Object.getOwnPropertyDescriptor(o,n);return i.get?i.get.call(r):i.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function e(t,n){return t.__proto__=n,t})(e,t)}function _createSuper(e){return function(){var t=_getPrototypeOf(e),n;if(_isNativeReflectConstruct()){var r=_getPrototypeOf(this).constructor;n=Reflect.construct(t,arguments,r)}else n=t.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)})(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e,t){function n(e){return S[e]||!1}function r(e){var t=e.post_types||[],n;if(t.length){t.push("wp_block");var r=acf.get("postType");if(-1===t.indexOf(r))return!1}if("string"==typeof e.icon&&"<svg"===e.icon.substr(0,4)){var o=e.icon;e.icon=React.createElement(M,null,o)}e.icon||delete e.icon,wp.blocks.getCategories().filter((function(t){return t.slug===e.category})).pop()||(console.warn('The block "'.concat(e.name,'" is registered with an unknown category "').concat(e.category,'".')),e.category="common");var i={id:{type:"string"},name:{type:"string"},data:{type:"object"},align:{type:"string"},mode:{type:"string"}},a=x,c=f;e.supports.align_content&&(i=d(i),a=m(a)),e=acf.parseArgs(e,{title:"",name:"",category:"",attributes:i,edit:function e(t){return React.createElement(a,t)},save:function e(t){return React.createElement(c,t)}}),S[e.name]=e;var s=wp.blocks.registerBlockType(e.name,e);return s.attributes.anchor&&(s.attributes.anchor={type:"string"}),s}function o(e){return"core/block-editor"===e?wp.data.select("core/block-editor")||wp.data.select("core/editor"):wp.data.select(e)}function i(e){return wp.data.dispatch(e)}function a(e){for(var t=o("core/block-editor").getBlocks(),n=0;n<t.length;)t=t.concat(t[n].innerBlocks),n++;for(var r in e)t=t.filter((function(t){return t.attributes[r]===e[r]}));return t}function c(t,n){var r=t.id,o=0,i=A[r]||{query:{},timeout:!1,promise:e.Deferred()};return i.query=_objectSpread({},i.query,{},n),clearTimeout(i.timeout),i.timeout=setTimeout((function(){e.ajax({url:acf.get("ajaxurl"),dataType:"json",type:"post",cache:!1,data:acf.prepareForAjax({action:"acf/ajax/fetch-block",block:JSON.stringify(t),query:i.query})}).always((function(){A[r]=null})).done((function(){i.promise.resolve.apply(this,arguments)})).fail((function(){i.promise.reject.apply(this,arguments)}))}),0),A[r]=i,i.promise}function s(e,t){return JSON.stringify(e)===JSON.stringify(t)}function u(e){var t=l(e.nodeName.toLowerCase());if(!t)return null;var n={};acf.arrayArgs(e.attributes).map(p).forEach((function(e){n[e.name]=e.value}));var r=[t,n];return acf.arrayArgs(e.childNodes).forEach((function(e){if(e instanceof Text){var t=e.textContent.trim();t&&r.push(t)}else r.push(u(e))})),React.createElement.apply(this,r)}function l(e){switch(e){case"innerblocks":return _;case"script":return B;case"#comment":return null}return e}function p(e){var t=e.name,n=e.value;switch(t){case"class":t="className";break;case"style":var r={};n.split(";").forEach((function(e){var t=e.indexOf(":");if(t>0){var n=e.substr(0,t).trim(),o=e.substr(t+1).trim();"-"!==n.charAt(0)&&(n=acf.strCamelCase(n)),r[n]=o}})),n=r;break;default:var o=acf.get("jsxAttributes");o[t]&&(t=o[t]);var i=n.charAt(0);0===t.indexOf("data-")||"["!==i&&"{"!==i||(n=JSON.parse(n));break}return{name:t,value:n}}function f(){return React.createElement(_.Content,null)}function h(){wp.blockEditor||(wp.blockEditor=wp.editor);var e=acf.get("blockTypes");e&&e.map(r)}function d(e){return e.align_content={type:"string"},e}function m(e){return H?function(t){function r(e){var t;return _classCallCheck(this,r),(t=o.call(this,e)).setup(),t}_inherits(r,t);var o=_createSuper(r);return _createClass(r,[{key:"setup",value:function e(){var t=this.props,r=t.name,o=t.attributes,i=n(r);o.id||(o.align_content=o.align_content||i.align_content||"center center")}},{key:"render",value:function t(){function n(e){i({align_content:e})}var r=this.props,o=r.attributes,i=r.setAttributes,a=o.align_content;return React.createElement(C,null,React.createElement(e,this.props),React.createElement(v,null,React.createElement(H,{label:acf.__("Change content alignment"),value:a,onChange:n})))}}]),r}(j):e}var y=wp.blockEditor,v=y.BlockControls,b=y.InspectorControls,_=y.InnerBlocks,g=wp.components,k=g.Toolbar,w=g.IconButton,O=g.Placeholder,R=g.Spinner,C=wp.element.Fragment,E,j=React.Component,P=wp.data.withSelect,S={},A={};acf.parseJSX=function(t){return u(e(t)[0])};var x=function(e){function t(e){var n;return _classCallCheck(this,t),(n=r.call(this,e)).setup(),n}_inherits(t,e);var r=_createSuper(t);return _createClass(t,[{key:"setup",value:function e(){function t(e){-1===e.indexOf(i.mode)&&(i.mode=e[0])}var r=this.props,o=r.name,i=r.attributes,c=r.clientId,s=r.setAttributes,u=n(o),l;i.id?a().filter((function(e){return e.attributes.id===i.id})).filter((function(e){return e.clientId!==c})).pop()&&(i.id=acf.uniqid("block_")):(i.id=acf.uniqid("block_"),i.name=u.name,i.mode=i.mode||u.mode,i.data=i.data||u.data,u.align&&s({align:u.align}));switch(u.mode){case"edit":t(["edit","preview"]);break;case"preview":t(["preview","edit"]);break;default:t(["auto"]);break}}},{key:"render",value:function e(){function t(){c({mode:"preview"===s?"edit":"preview"})}var r=this.props,o=r.name,i=r.attributes,a=r.isSelected,c=r.setAttributes,s=i.mode,u,l=n(o).supports.mode;"auto"===s&&(l=!1);var p="preview"===s?acf.__("Switch to Edit"):acf.__("Switch to Preview"),f="preview"===s?"edit":"welcome-view-site";return React.createElement(C,null,React.createElement(v,null,l&&React.createElement(k,null,React.createElement(w,{className:"components-icon-button components-toolbar__control",label:p,icon:f,onClick:t}))),React.createElement(b,null,"preview"===s&&React.createElement("div",{className:"acf-block-component acf-block-panel"},React.createElement($,this.props))),React.createElement(D,this.props))}}]),t}(j),T=function(e){function t(){return _classCallCheck(this,t),n.apply(this,arguments)}_inherits(t,e);var n=_createSuper(t);return _createClass(t,[{key:"render",value:function e(){var t=this.props,n=t.attributes,r=t.isSelected,o=n.mode;return React.createElement("div",{className:"acf-block-component acf-block-body"},"auto"===o&&r?React.createElement($,this.props):"auto"!==o||r?"preview"===o?React.createElement(q,this.props):React.createElement($,this.props):React.createElement(q,this.props))}}]),t}(j),D=P((function(e,t){return{index:e("core/editor").getBlockIndex(t.clientId)}}))(T),M=function(e){function t(){return _classCallCheck(this,t),n.apply(this,arguments)}_inherits(t,e);var n=_createSuper(t);return _createClass(t,[{key:"render",value:function e(){return React.createElement("div",{dangerouslySetInnerHTML:{__html:this.props.children}})}}]),t}(j),B=function(t){function n(){return _classCallCheck(this,n),r.apply(this,arguments)}_inherits(n,t);var r=_createSuper(n);return _createClass(n,[{key:"render",value:function e(){var t=this;return React.createElement("div",{ref:function e(n){return t.el=n}})}},{key:"setHTML",value:function t(n){e(this.el).html("<script>".concat(n,"<\/script>"))}},{key:"componentDidUpdate",value:function e(){this.setHTML(this.props.children)}},{key:"componentDidMount",value:function e(){this.setHTML(this.props.children)}}]),n}(j),N={},I=function(t){function n(e){var t;return _classCallCheck(this,n),(t=r.call(this,e)).setRef=t.setRef.bind(_assertThisInitialized(t)),t.id="",t.el=!1,t.subscribed=!0,t.renderMethod="jQuery",t.setup(e),t.loadState(),t}_inherits(n,t);var r=_createSuper(n);return _createClass(n,[{key:"setup",value:function e(t){}},{key:"fetch",value:function e(){}},{key:"loadState",value:function e(){this.state=N[this.id]||{}}},{key:"setState",value:function e(t){N[this.id]=_objectSpread({},this.state,{},t),this.subscribed&&_get(_getPrototypeOf(n.prototype),"setState",this).call(this,t)}},{key:"setHtml",value:function t(n){if((n=n?n.trim():"")!==this.state.html){var r={html:n};"jsx"===this.renderMethod?(r.jsx=acf.parseJSX(n),r.$el=e(this.el)):r.$el=e(n),this.setState(r)}}},{key:"setRef",value:function e(t){this.el=t}},{key:"render",value:function e(){return this.state.jsx?React.createElement("div",{ref:this.setRef},this.state.jsx):React.createElement("div",{ref:this.setRef},React.createElement(O,null,React.createElement(R,null)))}},{key:"shouldComponentUpdate",value:function e(t,n){return t.index!==this.props.index&&this.componentWillMove(),n.html!==this.state.html}},{key:"display",value:function t(n){if("jQuery"===this.renderMethod){var r=this.state.$el,o=r.parent(),i=e(this.el);i.html(r),o.length&&o[0]!==i[0]&&o.html(r.clone())}switch(n){case"append":this.componentDidAppend();break;case"remount":this.componentDidRemount();break}}},{key:"componentDidMount",value:function e(){void 0===this.state.html?this.fetch():this.display("remount")}},{key:"componentDidUpdate",value:function e(t,n){this.display("append")}},{key:"componentDidAppend",value:function e(){acf.doAction("append",this.state.$el)}},{key:"componentWillUnmount",value:function e(){acf.doAction("unmount",this.state.$el),this.subscribed=!1}},{key:"componentDidRemount",value:function e(){var t=this;this.subscribed=!0,setTimeout((function(){acf.doAction("remount",t.state.$el)}))}},{key:"componentWillMove",value:function e(){var t=this;acf.doAction("unmount",this.state.$el),setTimeout((function(){acf.doAction("remount",t.state.$el)}))}}]),n}(j),$=function(e){function t(){return _classCallCheck(this,t),n.apply(this,arguments)}_inherits(t,e);var n=_createSuper(t);return _createClass(t,[{key:"setup",value:function e(t){this.id="BlockForm-".concat(t.attributes.id)}},{key:"fetch",value:function e(){var t=this,n;c(this.props.attributes,{form:!0}).done((function(e){t.setHtml(e.data.form)}))}},{key:"componentDidAppend",value:function e(){function n(e){var t=arguments.length>0&&void 0!==e&&e,n=acf.serialize(a,"acf-".concat(o.id));t?o.data=n:i({data:n})}_get(_getPrototypeOf(t.prototype),"componentDidAppend",this).call(this);var r=this.props,o=r.attributes,i=r.setAttributes,a=this.state.$el,c=!1;a.on("change keyup",(function(){clearTimeout(c),c=setTimeout(n,300)})),o.data||n(!0)}}]),t}(I),q=function(e){function t(){return _classCallCheck(this,t),r.apply(this,arguments)}_inherits(t,e);var r=_createSuper(t);return _createClass(t,[{key:"setup",value:function e(t){var r;this.id="BlockPreview-".concat(t.attributes.id),n(t.name).supports.__experimental_jsx&&(this.renderMethod="jsx")}},{key:"fetch",value:function e(t){var n=this;t=t||this.props.attributes,this.setState({prevAttributes:t}),c(t,{preview:!0}).done((function(e){n.setHtml(e.data.preview)}))}},{key:"componentDidAppend",value:function e(){_get(_getPrototypeOf(t.prototype),"componentDidAppend",this).call(this);var n=this.props.attributes,r=this.state.$el,o=n.name.replace("acf/","");acf.doAction("render_block_preview",r,n),acf.doAction("render_block_preview/type=".concat(o),r,n)}},{key:"shouldComponentUpdate",value:function e(n,r){return s(n.attributes,this.props.attributes)||this.fetch(n.attributes),_get(_getPrototypeOf(t.prototype),"shouldComponentUpdate",this).call(this,n,r)}},{key:"componentDidRemount",value:function e(){_get(_getPrototypeOf(t.prototype),"componentDidRemount",this).call(this),s(this.state.prevAttributes,this.props.attributes)||this.fetch()}}]),t}(I);acf.addAction("ready",h);var H=wp.blockEditor.BlockAlignmentMatrixToolbar||wp.blockEditor.__experimentalBlockAlignmentMatrixToolbar}(jQuery);